# ðŸŸ¦ Daily Drill: KQL 101 (Microsoft Sentinel Logic)
**Date:** 2026-02-09
**Source:** KC7 Cyber
**Topic:** Kusto Query Language (KQL) Fundamentals

## 1. Executive Summary
Completed the "KQL 101" module on KC7 Cyber. While Splunk uses SPL (Unix-style piping), KQL is the query language for the Microsoft ecosystem (Sentinel, Defender, Azure Monitor). It focuses on high-performance data retrieval using a structured, pipe-based syntax.

## 2. Core Commands (The Skeleton)
These commands structure the query and determine what data comes back.

| Command | Syntax Example | Description |
| :--- | :--- | :--- |
| **`take`** | `SecurityEvents | take 10` | Returns a specific number of rows. Equivalent to `head` in Linux. Useful for checking schema without loading massive data. |
| **`count`** | `SecurityEvents | count` | Aggregates the total number of records. |
| **`distinct`** | `... | distinct AccountName` | Removes duplicates. returns only unique values for the specified column. |
| **`where`** | `... | where TimeGenerated > ago(1h)` | The filter. This is the most important command to reduce noise. |

## 3. Operators (The Filters)
Precision filtering is critical in threat hunting. KQL distinguishes between "exact" and "fuzzy" matches.

* **Equality (`==` vs `!=`):**
    * `EventID == 4688`: Strict match.
    * `ProcessName != "svchost.exe"`: Strict exclusion.
* **String Matching (`has` vs `contains`):**
    * **`has`**: Looks for a whole word (token). *Faster and more performant.*
        * `Command has "powershell"` matches `powershell.exe` but NOT `powershell_ise`.
    * **`contains`**: Looks for a substring. *Slower but thorough.*
        * `Command contains "powershell"` matches both `powershell.exe` and `MyPowershellScript`.
* **Logical Operators (`and`, `or`):**
    * `where EventID == 4624 and AccountType == "User"`
* **The List Operator (`in`):**
    * `where EventID in (4624, 4625, 4688)`: Checks if a value exists within a provided list. Cleaner than writing multiple `or` statements.

## 4. Advanced Logic
* **`//` (Comments):** Used to comment out lines for testing or documenting logic.
* **`let` (Variables):** Defines a variable for reuse. Crucial for complex detection logic.
    ```kql
    // Define the suspicious file name once
    let SuspiciousFile = "mimikatz.exe";
    DeviceFileEvents
    | where FileName == SuspiciousFile
    ```

## ðŸ§  Key Takeaway
KQL is optimized for speed. Understanding the difference between `has` (indexed token search) and `contains` (substring scan) is the difference between a query that takes 2 seconds and one that takes 20 minutes in a massive environment.